<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Logs</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container my-4">

    <!-- include header from layout.html -->
    <div th:replace="~{layout :: siteHeader}"></div>


    <div>Select query:</div>
    <nav>
        <a th:each="n : ${#numbers.sequence(1,13)}"
           th:text="${n}"
           th:href="@{/logs/{qid}(qid=${n})}"
           style="margin-right: 10px;"></a>
        <a
           th:text="'Search by IP'"
           th:href="@{/logs/14}"
           style="margin-right: 10px;"></a>
    </nav>
    <hr/>

    <h3 th:text="${queryTitle}"></h3>

    <form class="row g-3 align-items-end mb-3"
          th:if="${filters != null and !#lists.isEmpty(filters)}"
          th:action="@{/logs/{qid}(qid=${qid})}"
          method="get">

        <div th:each="fil : ${filters}">
            <label>
                <span th:text="${fil.title}"></span>
                <input th:type="${fil.uiType}" th:name="${fil.field}" th:value="${params[fil.field]} ?: (${fil.defaultValue} ?: '')" />
            </label>
        </div>

        <button type="submit">Run</button>
    </form>


    <section th:if="${columns != null and !#lists.isEmpty(columns)}">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered table-sm align-middle">
                <thead>
                <tr>
                    <th th:each="col : ${columns}" th:text="${col.title}"></th>
                    <th th:if="${qid == 14}" th:text="''"></th>

                </tr>
                </thead>

                <tbody>
                <tr th:each="row : ${logs}">
                    <td th:each="col : ${columns}">
                        <div th:switch="${col.uiType}">

                            <div th:case="'list'" class="pill-container" th:with="rawVal=${row[col.field]}">
                                <span class="badge pill text-bg-secondary mb-1"  th:each="val : ${#strings.listSplit(rawVal, ',')}" th:text="${#strings.trim(val)}"></span>
                            </div>

                            <div th:case="*">
                                <span th:name="${col.field}" th:text="${row[col.field]}" />
                            </div>

                        </div>
                    </td>
                    <th th:if="${qid == 14}">
                        <a th:text="'Edit'" th:href="@{/logs/get/{id}(id=${row['id']})}" style="margin-right: 10px;"></a>
                    </th>

                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- include footer from layout.html -->
    <div th:replace="~{layout :: siteFooter}"></div>
</div>
</body>
</html>
